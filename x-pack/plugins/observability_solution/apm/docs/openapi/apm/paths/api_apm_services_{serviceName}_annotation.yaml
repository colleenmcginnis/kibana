post:
  summary: Create or update an annotation
  description: >
    Create a new annotation for a specific service.

    By default, annotations are stored in a newly created
    `observability-annotations` index.

    The name of this index can be changed in your `config.yml` by editing
    `xpack.observability.annotations.index`.

    If you change the default index name, youâ€™ll also need to update your [user
    privileges](https://www.elastic.co/guide/en/observability/current/apm-app-annotation-user-create.html)
    accordingly.
  operationId: createAnnotation
  tags:
    - APM annotations
  parameters:
    - name: serviceName
      in: path
      required: true
      description: The name of the service.
      schema:
        type: string
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          properties:
            service:
              type: object
              description: Service identifying the configuration to create or update.
              properties:
                version:
                  type: string
                  description: Version of service.
                  example: '1.2'
                environment:
                  type: string
                  description: Environment of service.
                  example: production
              required:
                - version
            '@timestamp':
              type: string
              description: >
                The date and time of the annotation.

                Must be in [ISO 8601](https://www.w3.org/TR/NOTE-datetime)
                format.
              example: '2024-07-21T10:31:30.452Z'
            message:
              type: string
              description: The message displayed in the annotation.
              example: Deployment 1.2
              default: service.version
            tags:
              type: array
              description: >
                Distinguish APM annotations from other annotations.

                Defaults to `["apm"]`, and while you can add additional tags,
                you cannot remove the `apm` tag.
              items:
                type: string
              default:
                - apm
              example:
                - apm
                - my-tag
          required:
            - '@timestamp'
            - service
  responses:
    '200':
      description: Annotation created successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              _index:
                type: string
                example: observability-annotations
              _id:
                type: string
                example: Lc9I93EBh6DbmkeV7nFX
              _version:
                type: integer
                example: 1
              _seq_no:
                type: integer
                example: 0
              _primary_term:
                type: integer
                example: 1
              found:
                type: boolean
                example: true
              _source:
                type: object
                properties:
                  message:
                    type: string
                    example: Deployment 1.2
                  '@timestamp':
                    type: string
                    example: '2024-07-21T10:31:30.452Z'
                  service:
                    type: object
                    properties:
                      version:
                        type: string
                        example: '1.2'
                      name:
                        type: string
                        example: my-node-service
                      environment:
                        type: string
                  annotation:
                    type: object
                    properties:
                      type:
                        type: string
                        example: deployment
                  tags:
                    type: array
                    items:
                      type: string
                    example:
                      - apm
                      - elastic.co
                      - customer
                  event:
                    type: object
                    properties:
                      created:
                        type: string
                        example: '2024-08-30T15:46:43.259Z'

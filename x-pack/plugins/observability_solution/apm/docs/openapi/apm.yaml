openapi: 3.0.0
info:
  title: APM UI
  version: 1.0.0
  description: Kibana APIs for working with the APM UI.
tags:
  - name: APM agent keys
    description: >
      Configure APM agent keys to authorize requests from APM agents to the APM Server.
    externalDocs:
      description: APM agent API key documentation
      url: https://www.elastic.co/guide/en/observability/current/apm-api-key.html
  - name: APM annotations
    description: >
      Annotate visualizations in the APM app with significant events.
      Annotations enable you to easily see how events are impacting the performance of your applications.
paths:
  /api/apm/agent_keys:
    post:
      summary: Create an APM agent key
      description: |
        Create an APM agent API key.
        Specify API key privileges in the request body at creation time.

        You must have at least the `manage_own_api_key` cluster privilege and the APM application-level privileges that it wishes to grant. For more information refer to [Grant privileges and roles needed for API key management](https://www.elastic.co/guide/en/observability/current/apm-privileges-api-key.html).
      operationId: createAgentKey
      tags:
        - APM agent keys
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  description: Name of the APM agent key.
                  type: string
                  example: my-new-apm-key
                privileges:
                  description: |
                    APM agent key privileges. It can take one or more of the following values:

                    * `event:write`: Required for ingesting APM agent events.
                    * `config_agent:read`: Required for APM agents to read agent configuration remotely.
                  type: array
                  items:
                    type: string
                    enum:
                      - event:write
                      - config_agent:read
                  example: ["event:write", "config_agent:read"]
              required:
                - name
                - privileges
      responses:
        "200":
          description: Agent key created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  api_key:
                    type: string
                    example: PjGloCGOTzaZr8ilUPvkjA
                  expiration:
                    type: integer
                    format: int64
                  id:
                    type: string
                    example: 3DCLmn0B3ZMhLUa7WBG9
                  name:
                    type: string
                    example: my-new-apm-key
                  encoded:
                    type: string
                    example: M0RDTG1uMEIzWk1oTFVhN1dCRzk6UGpHbG9DR09UemFacjhpbFVQdmtqQQ
  /api/apm/services/{serviceName}/annotation/search:
    get:
      summary: Search for annotations
      description: Search for annotations related to a specific service.
      operationId: getAnnotation
      tags:
        - APM annotations
      parameters:
        - name: serviceName
          in: path
          required: true
          description: The name of the service
          schema:
            type: string
        - name: environment
          in: query
          required: false
          description: The environment to filter annotations by
          schema:
            type: string
        - name: start
          in: query
          required: false
          description: The start date for the search
          schema:
            type: string
        - name: end
          in: query
          required: false
          description: The end date for the search
          schema:
            type: string
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  annotations:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          enum:
                            - version
                        id:
                          type: string
                        "@timestamp":
                          type: number
                        text:
                          type: string
  /api/apm/services/{serviceName}/annotation:
    post:
      summary: Create a service annotation
      description: Create a new annotation for a specific service.
      operationId: createAnnotation
      tags:
        - APM annotations
      parameters:
        - name: serviceName
          in: path
          required: true
          description: The name of the service
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                '@timestamp':
                  type: string
                service:
                  type: object
                  properties:
                    version:
                      type: string
                    environment:
                      type: string
                message:
                  type: string
                tags:
                  type: array
                  items:
                    type: string

      responses:
        '200':
          description: Annotation created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                  _index:
                    type: string
                  _source:
                    type: object
                    properties:
                      annotation:
                        type: string
                      tags:
                        type: array
                        items:
                          type: string
                      message:
                        type: string
                      service:
                        type: object
                        properties:
                          name:
                            type: string
                          environment:
                            type: string
                          version:
                            type: string
                      event:
                        type: object
                        properties:
                          created:
                            type: string
                      '@timestamp':
                        type: string
